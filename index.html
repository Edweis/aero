<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Countries, Prefixes, and Time </title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        max-width: 700px;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 10px;
        text-align: left;
      }
      th {
        background-color: #f4f4f4;
      }
      tr:hover {
        background-color: #eee;
      }
      .timezone-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
        margin-bottom: 20px;
        max-width: 700px;
      }
      #tz-comparison {
        margin-bottom: 20px;
      }
      #working-hours-form {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-bottom: 12px;
      }
      #working-hours-form input[type="number"] {
        width: 50px;
      }
      #tz-table {
        max-width: none;
        border-collapse: separate;
        border-spacing: 0;
        table-layout: fixed;
        width: 1025px;
      }
      #tz-table thead th {
        position: sticky;
        top: 0;
        z-index: 1;
        background-color: #f4f4f4;
      }
      #tz-table thead th.working-hour {
        background-color: #d4edda;
      }
      #tz-table th,
      #tz-table td {
        padding: 4px 6px;
        text-align: center;
        font-size: 13px;
      }
      #tz-table th:first-child,
      #tz-table td:first-child {
        text-align: left;
        white-space: nowrap;
        width: 160px;
      }
      #tz-table th.current-hour {
        background-color: #fff3cd;
        font-weight: bold;
      }
      #tz-table td.current-hour {
        background-color: #fff3cd;
      }
      #tz-table td.working-hour {
        background-color: #d4edda;
      }
      #tz-table td.working-hour.current-hour {
        background-color: #a3d9a5;
        font-weight: bold;
      }
      #tz-table tr.highlighted-row td {
        background-color: #cfe2ff;
      }
      #tz-table tr.highlighted-row td.current-hour {
        background-color: #a0c4ff;
        font-weight: bold;
      }
      #tz-table tr.highlighted-row td.working-hour {
        background-color: #a0c4ff;
      }
      #tz-table tr.highlighted-row td.working-hour.current-hour {
        background-color: #7aadff;
        font-weight: bold;
      }
      #tz-table .region-header th {
        background-color: #e9ecef;
        text-align: left;
        font-size: 12px;
        padding: 4px 6px;
      }
      .timezone-card {
        border: 1px solid #ddd;
        padding: 12px;
        border-radius: 6px;
        text-align: center;
        background-color: #f9f9f9;
      }
    </style>
  </head>
  <body>
    <h1>Countries, Phone Prefixes, and Current Time</h1>
    <section id="tz-comparison">
      <h2>Timezone Comparison</h2>
      <form id="working-hours-form">
        <label>
          Work start
          <input type="number" id="work-start" value="8" min="0" max="23" />
        </label>
        <label>
          Work end
          <input type="number" id="work-end" value="17" min="0" max="23" />
        </label>
      </form>
      <div style="overflow: auto; max-height: 80vh;">
        <table id="tz-table">
          <thead>
            <tr><th>Timezone</th></tr>
          </thead>
          <tbody id="tz-table-body"></tbody>
        </table>
      </div>
    </section>
    <ul>
      Countries I can call
      <li>Austria</li>
      <li>Belgium</li>
      <li>Bulgaria Croatia</li>
      <li>Canada</li>
      <li>China</li>
      <li>Cyprus (Greece part)</li>
      <li>Czech Republic</li>
      <li>Denmark</li>
      <li>Estonia</li>
      <li>Finland</li>
      <li>France</li>
      <li>Germany Greece</li>
      <li>Hongkong</li>
      <li>Hungary Ireland</li>
      <li>Iceland</li>
      <li>India</li>
      <li>Israel</li>
      <li>Italy</li>
      <li>Korea</li>
      <li>Latvia</li>
      <li>Liechtenstein</li>
      <li>Lithuania</li>
      <li>Luxembourg</li>
      <li>Malaysia</li>
      <li>Malta</li>
      <li>Morocco (only landline)</li>
      <li>Norway Poland</li>
      <li>Portugal Romania</li>
      <li>Singapore</li>
      <li>Slovakia</li>
      <li>Slovenia</li>
      <li>South Africa Switzerland</li>
      <li>Spain</li>
      <li>Sweden</li>
      <li>Thailand</li>
      <li>Turkey (only landline)</li>
      <li>United Kingdom</li>
      <li>USA</li>
    </ul>

    <script>
      const allTimezones = Intl.supportedValuesOf('timeZone').map(tz => {
        const parts = tz.split('/');
        const name = parts[parts.length - 1].replace(/_/g, ' ');
        return { timezone: tz, name };
      });



      function getLocalDate() {
        const now = new Date();
        const timezoneOffset = now.getTimezoneOffset() * 60000; // Convert minutes to milliseconds
        return new Date(now.getTime() - timezoneOffset);
      }
      function getHourInTimezone(timezone, referenceDate) {
        const formatter = new Intl.DateTimeFormat('en-US', {
          timeZone: timezone,
          hour: 'numeric',
          hour12: false,
        });
        const hour = parseInt(formatter.format(referenceDate), 10);
        return hour === 24 ? 0 : hour;
      }

      function isWorkingHour(hour, start, end) {
        if (start <= end) return hour >= start && hour < end;
        return hour >= start || hour < end;
      }

      const pinnedTimezones = [
        { name: 'Netherlands', timezone: 'Europe/Amsterdam' },
        { name: 'New York (EST)', timezone: 'America/New_York' },
        { name: 'Los Angeles (PST)', timezone: 'America/Los_Angeles' },
        { name: 'Sydney (NSW)', timezone: 'Australia/Sydney' },
        { name: 'Brisbane (QLD)', timezone: 'Australia/Brisbane' },
        { name: 'Melbourne (VIC)', timezone: 'Australia/Melbourne' },
        { name: 'Perth (WA)', timezone: 'Australia/Perth' },
        { name: 'Adelaide (SA)', timezone: 'Australia/Adelaide' },
        { name: 'Hobart (TAS)', timezone: 'Australia/Hobart' },
        { name: 'Darwin (NT)', timezone: 'Australia/Darwin' },
        { name: 'SÃ£o Paulo', timezone: 'America/Sao_Paulo' },
        { name: 'Toronto', timezone: 'America/Toronto' },
        { name: 'Vancouver', timezone: 'America/Vancouver' },
        { name: 'London', timezone: 'Europe/London' },
        { name: 'Paris', timezone: 'Europe/Paris' },
        { name: 'Dublin', timezone: 'Europe/Dublin' },
        { name: 'Berlin', timezone: 'Europe/Berlin' },
        { name: 'Istanbul', timezone: 'Europe/Istanbul' },
        { name: 'New Zealand', timezone: 'Pacific/Auckland' },
        { name: 'India', timezone: 'Asia/Kolkata' },
        { name: 'Hong Kong', timezone: 'Asia/Hong_Kong' },
        { name: 'Singapore', timezone: 'Asia/Singapore' },
      ];

      const southAmericaZones = new Set([
        'America/Argentina/Buenos_Aires','America/Sao_Paulo','America/Santiago',
        'America/Bogota','America/Guayaquil','America/Guyana','America/Asuncion',
        'America/Lima','America/Paramaribo','America/Montevideo','America/Caracas',
        'America/La_Paz',
      ]);
      const europeWET = new Set([
        'Europe/London','Europe/Dublin','Europe/Lisbon','Atlantic/Reykjavik',
      ]);
      const europeEET = new Set([
        'Europe/Athens','Europe/Bucharest','Europe/Helsinki','Europe/Kiev',
        'Europe/Riga','Europe/Vilnius','Europe/Chisinau','Europe/Tallinn',
        'Europe/Sofia','Asia/Nicosia',
      ]);
      const europeFar = new Set([
        'Europe/Moscow','Europe/Minsk','Europe/Istanbul',
      ]);
      const middleEastZones = new Set([
        'Asia/Bahrain','Asia/Baghdad','Asia/Riyadh','Asia/Kuwait','Asia/Qatar',
        'Asia/Dubai','Asia/Muscat','Asia/Aden','Asia/Jerusalem','Asia/Amman',
        'Asia/Beirut','Asia/Damascus','Asia/Tehran',
      ]);

      const regionOrder = [
        'Europe_CET','Europe_WET','Europe_EET','Europe_3',
        'North_America','South_America',
        'Middle_East','Asia','Africa',
        'Australia','Pacific','Indian','Atlantic',
      ];
      const regionLabels = {
        'Europe_WET': 'Europe (UTC+0)',
        'Europe_CET': 'Europe (UTC+1)',
        'Europe_EET': 'Europe (UTC+2)',
        'Europe_3': 'Europe (UTC+3)',
        'North_America': 'North America',
        'South_America': 'South America',
        'Middle_East': 'Middle East',
        'Africa': 'Africa',
        'Asia': 'Asia',
        'Australia': 'Oceania',
        'Pacific': 'Oceania',
        'Indian': 'Indian Ocean',
        'Atlantic': 'Atlantic',
      };

      function getRegion(timezone) {
        if (europeWET.has(timezone)) return 'Europe_WET';
        if (europeEET.has(timezone)) return 'Europe_EET';
        if (europeFar.has(timezone)) return 'Europe_3';
        if (timezone.startsWith('Europe/')) return 'Europe_CET';
        if (southAmericaZones.has(timezone)) return 'South_America';
        if (timezone.startsWith('America/')) return 'North_America';
        if (middleEastZones.has(timezone)) return 'Middle_East';
        return timezone.split('/')[0];
      }

      function getSelectedTimezones() {
        const pinnedZones = new Set(pinnedTimezones.map(p => p.timezone));
        const seen = new Set();
        const rest = allTimezones.filter(item => {
          if (pinnedZones.has(item.timezone)) return false;
          if (seen.has(item.timezone)) return false;
          seen.add(item.timezone);
          return true;
        });

        const grouped = {};
        rest.forEach(item => {
          const region = getRegion(item.timezone);
          if (!grouped[region]) grouped[region] = [];
          grouped[region].push(item);
        });

        const result = [{ header: 'Pinned' }, ...pinnedTimezones];
        regionOrder.forEach(region => {
          if (grouped[region]) {
            result.push({ header: regionLabels[region] || region });
            result.push(...grouped[region]);
          }
        });

        // Add all IANA timezones not already shown
        const shownZones = new Set(pinnedTimezones.map(p => p.timezone));
        rest.forEach(item => shownZones.add(item.timezone));

        const allIana = Intl.supportedValuesOf('timeZone');
        const extraGrouped = {};
        allIana.forEach(tz => {
          if (shownZones.has(tz)) return;
          const region = tz.split('/')[0];
          if (!extraGrouped[region]) extraGrouped[region] = [];
          extraGrouped[region].push({ name: tz, timezone: tz });
        });

        const extraRegionOrder = Object.keys(extraGrouped).sort();
        if (extraRegionOrder.length > 0) {
          result.push({ header: 'All Timezones' });
          extraRegionOrder.forEach(region => {
            result.push({ header: region });
            result.push(...extraGrouped[region]);
          });
        }

        return result;
      }

      let referenceDate = new Date();
      let highlightedTimezone = null;

      function setNlHour(nlHour) {
        const d = new Date(referenceDate);
        const currentNlHour = getHourInTimezone('Europe/Amsterdam', d);
        d.setHours(d.getHours() + (nlHour - currentNlHour));
        referenceDate = d;
        updateAll();
      }

      function updateAll() {
        renderComparisonTable();
      }

      function renderComparisonTable() {
        const workStart = parseInt(document.getElementById('work-start').value, 10);
        const workEnd = parseInt(document.getElementById('work-end').value, 10);
        const nlHour = getHourInTimezone('Europe/Amsterdam', referenceDate);
        const timezones = getSelectedTimezones();

        const thead = document.querySelector('#tz-table thead tr');
        thead.innerHTML = '<th>Timezone</th>';
        for (let h = 0; h < 24; h++) {
          const th = document.createElement('th');
          th.textContent = h;
          if (h === nlHour) th.classList.add('current-hour');
          if (isWorkingHour(h, workStart, workEnd)) th.classList.add('working-hour');
          th.style.cursor = 'pointer';
          th.addEventListener('click', () => setNlHour(h));
          thead.appendChild(th);
        }

        const tbody = document.getElementById('tz-table-body');
        tbody.innerHTML = '';
        timezones.forEach(item => {
          if (item.header) {
            const row = document.createElement('tr');
            row.classList.add('region-header');
            const th = document.createElement('th');
            th.colSpan = 25;
            th.textContent = item.header;
            row.appendChild(th);
            tbody.appendChild(row);
            return;
          }
          const { name, timezone } = item;
          const row = document.createElement('tr');
          if (highlightedTimezone === timezone) row.classList.add('highlighted-row');
          const labelCell = document.createElement('td');
          labelCell.textContent = name;
          row.appendChild(labelCell);

          const targetCurrentHour = getHourInTimezone(timezone, referenceDate);
          const offset = ((targetCurrentHour - nlHour) % 24 + 24) % 24;

          for (let nlH = 0; nlH < 24; nlH++) {
            const td = document.createElement('td');
            const localHour = (nlH + offset) % 24;
            td.textContent = localHour;
            if (nlH === nlHour) td.classList.add('current-hour');
            if (isWorkingHour(localHour, workStart, workEnd)) td.classList.add('working-hour');
            td.style.cursor = 'pointer';
            td.addEventListener('click', () => {
              highlightedTimezone = highlightedTimezone === timezone ? null : timezone;
              setNlHour(nlH);
            });
            row.appendChild(td);
          }
          tbody.appendChild(row);
        });
      }


      document.getElementById('work-start').addEventListener('change', renderComparisonTable);
      document.getElementById('work-end').addEventListener('change', renderComparisonTable);
      updateAll();
    </script>
  </body>
</html>
